This document is the Single Source of Truth (SSOT) for The Stewards List project. It captures the project vision, technical constraints, standards, and the initial MVP scope. The contents are filled from repository evidence (Next.js + TypeScript app structure, `prisma/`, `lib/prisma.ts`, `tailwind.config.ts`, and app API routes) and conservative, production-grade assumptions where the repo is intentionally underspecified.

## 1. AI AGENT CONFIGURATION (CRITICAL)

The following persona and operational constraints are mandatory for the duration of the engagement. This enforces enterprise-grade outcomes (security, testability, maintainability) from day one.

| Key                  | Value to Be Adopted                                                                                                                                                                                                                                                                |
| -------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Role & Persona**   | Senior Principal Architect (20+ years) and pragmatic 10x Developer. Decisions emphasize maintainability, testability, observability, and scalable design. Deliverables must be immediately production-ready or contain explicit, low-risk migration steps to production readiness. |
| **Standard**         | Production-ready code: strong typing, comprehensive error handling, structured logging, dependency pinning, and automated tests (unit + simple integration). No placeholder logic for core features.                                                                               |
| **Methodology**      | Agile/Scrum hybrid. Work in small, prioritized sprints. Each deliverable includes: acceptance criteria, Definition of Done (tests passing, linting, types), and possible blockers. Use short iterations and keep PRs focused.                                                      |
| **Constraint Focus** | Prioritize security and scalabilityâ€”stateless services, principle of least privilege, secure defaults. When trade-offs are made, document long-term costs and migration path.                                                                                                      |
| **Output Format**    | All deliverables in Markdown and code files. Diagrams as Markdown block diagrams (ASCII / text-based) and data models in Markdown tables. Code in TypeScript (where applicable) and follow repo conventions.                                                                       |

## 2. PROJECT CORE VISION

| Field                  | Description                                                                                                                                                                                                                                                        |
| ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Project Name**       | The Stewards List                                                                                                                                                                                                                                                  |
| **Core Goal**          | Provide a simple, reliable home-organization app that lets households and small teams create, assign, track, and log recurring tasks with permissions and light communication (chat). The product focuses on clear responsibilities and a usable activity history. |
| **Target Audience**    | Households, roommates, small teams (property managers, caretakers), and local community groups who need structured task assignment and tracking without enterprise overhead. Audience expects simple UX, mobile-friendly pages, and light privacy controls.        |
| **Monetization Model** | Open Source core (initial). Optionally offer a hosted SaaS tier later (subscription) for backups, multi-property organizations, and advanced analytics. MVP: no monetization integration.                                                                          |
| **Initial MVP Scope**  | Minimal, high-value features required for v1.0:                                                                                                                                                                                                                    |

|- User accounts with secure email/password authentication and role support (Admin / Manager / Member).
|- Tasks: create, edit, assign, due dates, recurring options (basic), status (todo/in-progress/done).
|- Task Logs: record completion history and simple audit events (who, when, note).
|- Permissions: basic role-based access and per-task ownership/assignment.
|- Lightweight chat/comments per task (inline messaging attached to a task).
|- REST API (JSON) endpoints and a responsive Next.js UI built with Tailwind CSS.

## 3. TECHNICAL STACK & INFRASTRUCTURE

| Component                       | Chosen Technology & Rationale                                                                                                                                                                                                              |
| ------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Frontend Language/Framework** | Next.js (React) with TypeScript (strict mode recommended). Evidence: `app/page.tsx`, `next.config.ts`, `next-env.d.ts`. Use React Server Components where appropriate; keep interactive parts as client components.                        |
| **Backend Language/Framework**  | Node.js runtime via Next.js API routes (app router `route.ts`). Target Node 20+ runtime for modern features and stable support. Use async/await and structured error handling.                                                             |
| **Primary Database**            | PostgreSQL (managed or self-hosted). Evidence: `prisma/` folder and `lib/prisma.ts` indicate Prisma is the ORM. Recommend PostgreSQL 15+ (or compatible) and use Prisma Migrate.                                                           |
| **Caching/Messaging**           | Initially: none required. Recommend Redis for session caching, locking, and rate-limiting in Phase 2 (deployed as a managed instance or container in Docker Compose). Use Redis for audit/event queue if needing background jobs later.    |
| **Styling Library/System**      | Tailwind CSS (utility-first). Evidence: `tailwind.config.ts` and usage in `app/page.tsx`. Enforce design tokens and small set of component classes for accessibility.                                                                      |
| **API Style**                   | RESTful JSON using Next.js API routes. Version APIs under `/api/v1/...` (even if initial routes are `/api/...`) to allow future evolution. Keep controllers thin and delegate logic to services.                                           |
| **Cloud/Hosting Provider**      | Frontend/serverless: Vercel (recommended) for Next.js; Data: managed Postgres (Supabase, RDS) or self-hosted Postgres via Docker Compose (repo includes `docker-compose.yml`). Provide Terraform/IaC later if moving to multi-environment. |
| **Source Control**              | Git with branching model: `main`, feature branches per story, `hotfix/*`. Use conventional commits (`feat:`, `fix:`, `chore:`) for automated changelog generation.                                                                         |
| **CI/CD Pipeline**              | GitHub Actions (recommended). Stages: lint (ESLint + Prettier), typecheck (tsc), test (Jest/TS-Jest + React Testing Library), build, and optional deployment. Add Snyk or GitHub Code Scanning for security scanning as second step.       |

## 3.5. CORE DESIGN PRINCIPLES & PATTERNS

The repository structure and framework selection favor an MVC-style separation that maps well to Next.js app router and Prisma.

| Principle                        | Decision & Rationale                                                                                                                                                                                                                                                         |
| -------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Architectural Pattern**        | Model-View-Controller (MVC). Models: Prisma schema + DAL; Views: Next.js React components (pages / components); Controllers: API route handlers (thin controllers delegating to services). Justification: aligns with Next.js pattern and preserves testable service layers. |
| **Object-Oriented Design (OOD)** | Apply SOLID principles at the service and repository level. Use TypeScript interfaces for service contracts and small, focused classes or modules for business logic. Avoid fat controllers by keeping all DB logic in DAL/Repository modules.                               |
| **Data Access Layer (DAL)**      | Prisma ORM. All DB access through repository modules (e.g., `services/tasksRepository.ts`) that return plain TypeScript types. Complex queries live in the DAL and are tested in isolation.                                                                                  |
| **Database Connection**          | Use the existing `lib/prisma.ts` pattern (singleton Prisma client) so there is a single client instance across the app. This prevents connection exhaustion in serverless or dev environments.                                                                               |
| **Configuration**                | Use environment variables only. Provide a central `config` module that validates environment variables at startup (zod / Joi). No hardcoded secrets in code or checked-in config files.                                                                                      |

## 4. FUNCTIONAL REQUIREMENTS (WHAT it does)

| Component                | Requirements                                                                                                                                                                                                                                                                                                                                                                                            |
| ------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Authentication/Users** | Email/password authentication with secure password hashing (recommend Argon2 or bcrypt with strong params). Support role-based access control (Admin / Manager / Member). Token strategy: short-lived JWT access tokens + refresh tokens stored securely (httpOnly cookies) OR NextAuth if built-in Oauth/social is later required. Provide account management (profile, change password, soft-delete). |
| **Core Business Logic**  | The primary user interactions:                                                                                                                                                                                                                                                                                                                                                                          |

|- Create and manage tasks: owners and assignees, due dates, simple recurrence rules (daily/weekly), priorities.
|- Assign tasks to users or user groups and send in-app notifications.
|- Task logging: record completion events and comments; searchable audit trail per task.
|- Permissions enforcement: Admin/Manager roles can manage tasks and users; Members can see and act only on assigned or public tasks.
|- Lightweight chat/comments: task-attached messages for coordination (not a full chat server). |
| **Data Storage** | Primary data in Postgres via Prisma. No file uploads in MVP. Use soft-delete for records and enable an audit log table for compliance and troubleshooting. Encrypt database backups at rest (provided by managed DB or encrypted disk). |
| **Integrations** | MVP: none required. Recommended future integrations: SendGrid (transactional email), Stripe (hosted billing for SaaS), Sentry (error monitoring). All external calls must include retry/backoff and circuit-breaker considerations for robustness. |
| **User Interface (UI/UX)** | Modern minimalist aesthetic using Tailwind CSS. Responsive first (mobile + desktop). Accessibility: aim for WCAG 2.1 AA compliance on core flows (forms, contrast, keyboard navigation). Provide ARIA attributes and test critical flows with axe. |

## 5. NON-FUNCTIONAL REQUIREMENTS (HOW well it does it)

| Requirement           | Metric / Constraint                                                                                                                                                                                                                                                                                     |
| --------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Security**          | OWASP Top 10 mitigations required. No plaintext secrets, parameterized queries (offered by Prisma), strict CORS policy, CSRF protection for stateful endpoints, secure cookies, and input validation. Add security scanning in CI (Snyk/CodeQL).                                                        |
| **Performance**       | Design target: 95th percentile API latency < 200 ms for typical endpoints under light-to-moderate load. Use caching (Redis) and DB indices for hot paths. Frontend first paint < 2s on mobile 3G simulated (progressively improved).                                                                    |
| **Scalability**       | Container-friendly and stateless API where possible. Support for horizontal scaling (Vercel serverless or containerized Node behind a load balancer) and database read replicas for scale-out reads. Plan for ~5,000 concurrent active users in the architecture and document how to scale beyond that. |
| **Maintainability**   | Unit + integration coverage goal > 80% for critical modules. Enforce linting (ESLint), formatting (Prettier), and Typescript strict-mode. Provide clear README and API docs (OpenAPI / simple Markdown). Keep commits small and PRs reviewed.                                                           |
| **Disaster Recovery** | Daily automated DB backups and weekly snapshot retention policy configurable per environment. Recovery Time Objective (RTO): 2 hours. Recovery Point Objective (RPO): 24 hours for standard plan (shorter for paid tiers). Document restore steps in repo `docs/restore.md`.                            |

## 6. PROJECT KICKOFF COMMAND

The repository is ready to start Phase 1. The next automated actions the AI agent will perform (after this file is accepted):

**PHASE 1: Architectural Blueprint**

- Task: Generate a simple Markdown architecture diagram and a precise data model describing the core entities (User, Task, TaskLog, Permission, ChatMessage) with fields and relations.
- Output: `Architectural_Docs/01_Architecture_Blueprint.md`

**PHASE 2: Project Plan & Sizing**

- Task: Create `Architectural_Docs/02_Project_Plan.md` with 15-25 actionable tasks: descriptions, priority (High/Med/Low), and complexity points (1-5).

**PHASE 3: Code Skeleton & Setup**

- Task: Produce an initial skeleton and setup files that conform to the above choices: `package.json` enhancements, CI skeleton (GitHub Actions), `prisma` initialization (migrations), `lib/config.ts` with validation, and a minimal `README.md` showing local development using `docker-compose.yml` or Vercel.

**AI Execution Command:** "Begin Phase 1: Architectural Blueprint."

---

Notes / Assumptions (explicit):

- Repository evidence used: `app/page.tsx` (project name + features), `prisma/` folder (Prisma present), `lib/prisma.ts` (Singleton pattern for DB client), `tailwind.config.ts` (Tailwind), `docker-compose.yml` exists (local DB and optional services supported).
- Where the repository is underspecified (e.g., exact OAuth provider, password hashing library), I recommended secure, production-ready defaults (Argon2 for hashing, Redis optional for caching). If you prefer different choices (NextAuth, bcrypt, or a different DB), I can update the mandate and downstream artifacts.

End of filled mandate.
